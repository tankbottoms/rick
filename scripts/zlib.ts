import { artifacts, ethers } from 'hardhat';
import { TextEncoder } from 'util';
import pako from 'pako';

async function main() {
  const Factory = await ethers.getContractFactory('TestGZip');
  const TestGZip = await Factory.connect((await ethers.getSigners())[0]).deploy();
  console.log('\n\nDeployed at', TestGZip.address);
  console.log('');

  const text = `<?xml version="1.0" encoding="UTF-8"?>
  <svg id="svg2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 450 450">
      <style>
          #svg2 path,
          #svg2 rect,
          #svg2 polygon {
              fill: currentColor;
          }
      </style>
      <path
          d="M225,450C100.98,450,.08,349.1,.08,225.08S100.98,.16,225,.16s224.92,100.9,224.92,224.92-100.9,224.92-224.92,224.92Zm0-443.54C104.45,6.46,6.38,104.54,6.38,225.08s98.07,218.62,218.62,218.62,218.62-98.07,218.62-218.62S345.55,6.46,225,6.46Z" />
      <path d="M419.22,335.53H30.8L225.01,90.45l.85,1.07,193.37,244.01Zm-383.96-2.16H414.76L225.01,93.93,35.26,333.37Z" />
      <path
          d="M225,359.26l-.85-1.07L30.79,114.18H419.21l-194.21,245.08ZM35.25,116.34l189.75,239.44L414.75,116.34H35.25Z" />
      <path
          d="M225,94.59c-26.08,0-47.29-21.22-47.29-47.29S198.92,0,225,0s47.3,21.22,47.3,47.3-21.22,47.29-47.3,47.29Zm0-88.29c-22.61,0-41,18.39-41,41s18.39,41,41,41,41-18.39,41-41S247.61,6.3,225,6.3Z" />
      <path
          d="M110.26,63.96c-15.61,0-28.31-12.7-28.31-28.31s12.7-28.31,28.31-28.31,28.3,12.7,28.3,28.31-12.7,28.31-28.3,28.31Zm0-54.46c-14.42,0-26.15,11.73-26.15,26.15s11.73,26.15,26.15,26.15,26.15-11.73,26.15-26.15-11.73-26.15-26.15-26.15Z" />
      <path
          d="M3.23,253.24c-15.61,0-28.31-12.7-28.31-28.31s12.7-28.31,28.31-28.31,28.31,12.7,28.31,28.31-12.7,28.31-28.31,28.31Zm0-54.45c-14.42,0-26.15,11.73-26.15,26.15s11.73,26.15,26.15,26.15,26.15-11.73,26.15-26.15-11.73-26.15-26.15-26.15Z" />
      <path
          d="M446.77,253.24c-15.61,0-28.31-12.7-28.31-28.31s12.7-28.31,28.31-28.31,28.3,12.7,28.3,28.31-12.7,28.31-28.3,28.31Zm0-54.45c-14.42,0-26.15,11.73-26.15,26.15s11.73,26.15,26.15,26.15,26.15-11.73,26.15-26.15-11.73-26.15-26.15-26.15Z" />
      <path
          d="M342.06,63.96c-15.61,0-28.31-12.7-28.31-28.31s12.7-28.31,28.31-28.31,28.3,12.7,28.3,28.31-12.7,28.31-28.3,28.31Zm0-54.46c-14.42,0-26.15,11.73-26.15,26.15s11.73,26.15,26.15,26.15,26.15-11.73,26.15-26.15-11.73-26.15-26.15-26.15Z" />
      <path
          d="M110.26,442.8c-15.61,0-28.31-12.7-28.31-28.3s12.7-28.31,28.31-28.31,28.3,12.7,28.3,28.31-12.7,28.3-28.3,28.3Zm0-54.45c-14.42,0-26.15,11.73-26.15,26.15s11.73,26.15,26.15,26.15,26.15-11.73,26.15-26.15-11.73-26.15-26.15-26.15Z" />
      <path
          d="M342.06,442.8c-15.61,0-28.31-12.7-28.31-28.3s12.7-28.31,28.31-28.31,28.3,12.7,28.3,28.31-12.7,28.3-28.3,28.3Zm0-54.45c-14.42,0-26.15,11.73-26.15,26.15s11.73,26.15,26.15,26.15,26.15-11.73,26.15-26.15-11.73-26.15-26.15-26.15Z" />
      <path
          d="M83.03,254.53c-16.24,0-29.45-13.21-29.45-29.45s13.21-29.45,29.45-29.45,29.45,13.21,29.45,29.45-13.21,29.45-29.45,29.45Zm0-56.74c-15.05,0-27.29,12.24-27.29,27.29s12.24,27.29,27.29,27.29,27.29-12.24,27.29-27.29-12.24-27.29-27.29-27.29Z" />
      <path
          d="M367.07,254.53c-16.24,0-29.45-13.21-29.45-29.45s13.21-29.45,29.45-29.45,29.45,13.21,29.45,29.45-13.21,29.45-29.45,29.45Zm0-56.74c-15.05,0-27.29,12.24-27.29,27.29s12.24,27.29,27.29,27.29,27.29-12.24,27.29-27.29-12.24-27.29-27.29-27.29Z" />
      <path
          d="M225,448.54c-26.08,0-47.29-20.92-47.29-46.63s21.22-46.63,47.29-46.63,47.3,20.92,47.3,46.63-21.22,46.63-47.3,46.63Zm0-86.97c-22.61,0-41,18.1-41,40.34s18.39,40.34,41,40.34,41-18.1,41-40.34-18.39-40.34-41-40.34Z" />
      <rect x="223.97" y="115.26" width="2.16" height="109.67" />
      <rect x="210.68" y="123.94" width="2.16" height="102.74" transform="translate(-38.16 60.78) rotate(-15)" />
      <rect x="201.79" y="142.16" width="2.16" height="88.71" transform="translate(-66.08 126.43) rotate(-30)" />
      <rect x="194.62" y="154.06" width="2.16" height="83.03" transform="translate(-80.97 195.66) rotate(-45)" />
      <polygon points="224.51 225.87 152.31 184.18 153.39 182.31 225.59 223.99 224.51 225.87" />
      <rect x="181.01" y="168.94" width="2.16" height="88.96" transform="translate(-71.19 334.07) rotate(-75)" />
      <path
          d="M331.32,225.94H117.65L225,89.7l.85,1.08,105.46,135.16Zm-107.34-2.16h102.92L225,93.19,122.1,223.78h101.88Z" />
      <rect x="185.85" y="174.23" width="102.74" height="2.16" transform="translate(6.56 359.16) rotate(-75.02)" />
      <rect x="201.74" y="185.44" width="88.71" height="2.16" transform="translate(-38.38 306.62) rotate(-60.05)" />
      <rect x="211.76" y="194.5" width="83.03" height="2.16" transform="translate(-64.11 236.38) rotate(-45)" />
      <rect x="218.34" y="203.01" width="83.37" height="2.16" transform="translate(-67.17 157.09) rotate(-29.95)" />
      <rect x="222.54" y="212.73" width="90.98" height="2.16" transform="translate(-44.06 71.84) rotate(-14.12)" />
      <rect x="223.97" y="223.93" width="2.16" height="109.67" />
      <rect x="160.38" y="272.47" width="102.74" height="2.16" transform="translate(-107.23 407.39) rotate(-75.02)" />
      <rect x="158.52" y="261.26" width="88.71" height="2.16" transform="translate(-125.71 307.21) rotate(-60.06)" />
      <rect x="154.18" y="252.2" width="83.03" height="2.16" transform="translate(-121.77 212.5) rotate(-44.99)" />
      <polygon points="153.39 266.55 152.31 264.67 224.51 222.99 225.59 224.86 153.39 266.55" />
      <rect x="137.6" y="234.36" width="88.96" height="2.16" transform="translate(-54.72 55.14) rotate(-15)" />
      <rect x="236.69" y="222.04" width="2.16" height="103.76" transform="translate(-64.5 73.42) rotate(-15.48)" />
      <rect x="245.38" y="217.89" width="2.16" height="90.15" transform="translate(-98.46 158.47) rotate(-30)" />
      <rect x="252.68" y="211.57" width="2.16" height="84.38" transform="translate(-105.11 253.76) rotate(-45)" />
      <rect x="259.82" y="203.59" width="2.16" height="83.37" transform="translate(-81.96 348.59) rotate(-60)" />
      <rect x="266.95" y="190.08" width="2.16" height="91.33" transform="translate(-29.05 433.63) rotate(-75)" />
      <path
          d="M236.17,224.93c0,6.14-4.98,11.12-11.12,11.12s-11.12-4.98-11.12-11.12,4.98-11.12,11.12-11.12,11.12,4.98,11.12,11.12Z" />
      <path d="M90.69,225.08c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M374.73,225.08c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M232.71,401.9c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M232.71,47.29c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M119.06,35.66c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M349.71,35.66c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M119.06,414.49c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M10.89,223.93c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M454.43,223.93c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path d="M349.71,414.49c0,4.23-3.43,7.66-7.66,7.66s-7.66-3.43-7.66-7.66,3.43-7.66,7.66-7.66,7.66,3.43,7.66,7.66Z" />
      <path
          d="M225,448.56l-.84-1.04L43.94,225.08l.55-.68L225,1.6l181.18,223.48-.55,.68-180.63,222.8ZM46.72,225.08l178.28,220.05,178.4-220.05L225,5.03,46.72,225.08Z" />
      <path
          d="M222.53,360.36L117.4,226.81v-3.9L222.53,89.49h4.96l104.1,133.43v3.87l-104.1,133.56h-4.96ZM123.88,224.86l101.11,128.45,100.12-128.45L224.99,96.55,123.88,224.86Z" />
  </svg>`;
  const input = new Uint8Array(new TextEncoder().encode(text));
  const compressed = pako.deflateRaw(input, { level: 9 });

  console.log('');
  console.log('input     : ', text.length, 'bytes');
  console.log('');
  console.log('original  : ', `0x${buf2hex(input.buffer)}`.length / 2, 'bytes');
  console.log('');
  console.log('compressed: ', `0x${buf2hex(compressed.buffer)}`.length / 2, 'bytes');
  console.log('');

  await TestGZip.deployed();
  const result = await TestGZip.puff(compressed, input.length);
  const decompressed = result[1];

  console.log('decompress: ', `${decompressed}`.length / 2, 'bytes');
  console.log('');
  console.log('');
}

main();

function buf2hex(buffer) {
  return Array.prototype.map.call(new Uint8Array(buffer), (x) => ('00' + x.toString(16)).slice(-2)).join('');
}
